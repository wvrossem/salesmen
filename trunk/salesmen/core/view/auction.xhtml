<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.org/rich"
				xmlns:a="http://richfaces.org/a4j" template="layout/template.xhtml">

    <ui:define name="body">
        <rich:panel id="bidPanel">
            <f:facet name="header">Auction</f:facet>
            <h:outputText value="Auction: #{viewAuction.auction.title}"/><br/>
            <h:outputText value="Desciption: #{viewAuction.auction.description}"/><br/>
            <h:outputText value="Starting price: #{viewAuction.auction.startingPrice}"/><br/>
            <h:outputText value="Auction ends: #{viewAuction.auction.endDate}"/><br/>
            <h:outputText id="highestBid"
                    value="Highest bid: #{viewAuction.highestBid.amount} by #{viewAuction.highestBid.owner.username}"
                    rendered="#{viewAuction.highestBid.amount!=0}"
                    /><br/>

            <ui:repeat value="#{viewAuction.images}" var="img">
                <s:graphicImage value="#{img.data}">
                    <s:transformImageSize width="200" maintainRatio="true"/>
                </s:graphicImage>
            </ui:repeat>

            <h:form id="bidForm">
			<fieldset>
            <a:region id="bidRegion">
                <h:inputText id="bidAmount" value="#{viewAuction.bidAmount}" style="width: 65px;"/>
                <a:commandButton id="bidButton"
                                 value="Bid!"
                                 action="#{viewAuction.bid(authenticatedUser)}"
                                 reRender="bidPanel"
                                 rendered="#{identity.loggedIn}"/>
                <rich:message for="bidRegion">
                    <f:facet name="errorMarker">
                        <h:graphicImage url="/img/msgerror.png"/>
                    </f:facet>
                    <f:facet name="infoMarker">
                            <h:graphicImage url="/img/true.png"/>
                    </f:facet>
                </rich:message>
                <br/>

                <a:outputPanel for="bidAmount" id="bidMessage">
                    <a:status for="bidRegion">
                        <f:facet name="start">
                            <h:graphicImage value="/img/ajax-loader.gif"/>
                        </f:facet>
                    </a:status>
                    <rich:message for="bidAmount"/>
                </a:outputPanel>

                <a:outputPanel id="bidHistory">
                    <h:outputText id="NoBidsFoundMessage"
                        value="No bids placed yet"
                        rendered="#{(viewAuction.bids != null and viewAuction.bids.size==0) or viewAuction.bids==null}"/>
                    <h:dataTable id="bids" value="#{viewAuction.bids}" var="b"
                        rendered="#{viewAuction.bids != null and viewAuction.bids.size!=0}">
                    <h:column id="ScreenNameColumn">
                        <f:facet name="header"><h:outputText value="User"/></f:facet>
                        #{b.owner.username}
                    </h:column>
                    <h:column id="AmountColumn">
                        <f:facet name="header"><h:outputText value="Amount"/></f:facet>
                        #{b.amount}
                    </h:column>
                    <h:column id="DateColumn">
                        <f:facet name="header"><h:outputText value="Date"/></f:facet>
                        #{b.date}
                    </h:column>
                    </h:dataTable>
                </a:outputPanel>    
            </a:region>
            </fieldset>
            </h:form>
            
            <h:form id="commentForm">
			<fieldset>
            <a:region id="commentRegion">
				Leave a message or comment below:
				<br/>
                <h:inputTextarea id="comment" value="#{viewAuction.commentText}">
                </h:inputTextarea>
				<br/>
                <a:commandButton id="commentButton"
                                 value="Send!"
                                 action="#{viewAuction.addComment(authenticatedUser)}"
                                 reRender="bidPanel"
                                 rendered="#{identity.loggedIn}"/>
                <br/>
                <a:outputPanel id="commentHistory">
                    <h:outputText id="NoCommentsMessage"
                        value="Not yet commented"
                        rendered="#{(viewAuction.comments != null and viewAuction.comments.size == 0) or viewAuction.comments == null}"/>
                    <h:dataTable id="comments"
                    	value="#{viewAuction.comments}" var="c"
                    	rendered="#{viewAuction.comments != null and viewAuction.comments.size != 0}">
                    <h:column id="ScreenNameColumn">
                        <f:facet name="header"><h:outputText value="User"/></f:facet>
                        #{c.user.username}
                    </h:column>
                    <h:column id="DateColumn">
                        <f:facet name="header"><h:outputText value="Date"/></f:facet>
                        #{c.date}
                    </h:column>
                    <h:column id="CommentColumn">
                        <f:facet name="header"><h:outputText value="Comment"/></f:facet>
                        #{c.content}
                    </h:column>
                    </h:dataTable>
                </a:outputPanel>    
            </a:region>
            </fieldset>
            </h:form>

            <div style="clear:both"/>

        </rich:panel>

    </ui:define>
</ui:composition>